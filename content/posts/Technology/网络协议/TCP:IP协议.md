---
title: "TCP/IP协议"
subtitle: ""
date: 2021-08-24T08:20:56+08:00
lastmod: 2021-08-24T08:20:56+08:00
draft: false
authors: []
description: ""

tags: []
categories: []
series: [网络协议]

hiddenFromHomePage: false
hiddenFromSearch: false

featuredImage: ""
featuredImagePreview: ""

toc:
  enable: true
math:
  enable: false
lightgallery: false
license: ""
---

<!--more-->
### 概念

TCP/IP是指「传输控制协议/网际协议」：

- 传输控制协议——定义应用程序之间的通信（TCP）；
- 网际协议——定义计算机之间的通信（IP）。

TCP负责将数据分割成包，而IP负责发送包，再由TCP组合成数据。

**TCP/IP协议包函一族协议，如：HTTP、FTP和邮件协议等**。

### TCP/IP的分层

![](tcp/ip协议的分层.jpeg)

1. 应用层，决定通信活动，如FTP、DNS、HTTP等；
2. 传输层，提供处于网络连接中的两台计算机之间的数据传输。

### IP

IP协议用来把数据包发送给对方，依赖两个条件：

- IP地址，路由器分配给计算机的地址，会发生改变；
- MAC地址，计算机自己的网络地址，固定不变；

IP地址与MAC绑定后，路由器就能找到对应的计算机。¬

#### IPv4

IP使用32比特或者4组0～255之间的数据为计算机编址（32➗ 8=4）。

#### IPv6

由于IPv4能提供的地址资源有限，所以又推出了IPv6.

总共128位，分8组，每组16位无符号整数，组间用：分隔。

#### 域名

由于IP太难记，所以又整出了个域名，靠DNS解析成IP。

### TCP

#### 连接过程（三次握手）

TCP可以确保无误的将输送达，并且可以确认数据是否送达，主要依靠三次握手：

1. 发送端发送一个带SYN标志的数据包给对方，用于指明要访问的端口号；
2. 接收端收到后返回一个SYN/ACK标志的数据包，表示我收到了，并且同意访问该端口；
3. 发送端收到SYN/ACK的数据包后，再发送一个ACK标志的数据包，申请与目标端口建立连接。

##### 为何要三次握手而不是两次握手？

  假设只有两次握手，当client发出的第一个FIN（第一次握手）因网络延迟，在client连接关闭后才到达server，server收到了失效的请求，仍然会返回ACK（第二次握手），此时连接就建立了，但是client并不会发送数据，而server却会持续等待，这样就造成了资源浪费。

##### SYN攻击

Client在短时间内伪造大量IP地址并向Server不断发送SYN包，Server收到后恢复ACK确认包，但是持续等不到回应，Server会不断重发直至超时，由于伪造的SYN包长时间占用未连接队列，导致正常的SYN请求不能入队而被丢弃，从而引起网络堵塞甚至系统瘫痪。这是一种典型的DDOS攻击。

#### 断连过程（四次挥手）

1. 发送端发送一个带FIN标志的数据包，表示自己没有数据可发送了，但是仍可接收数据；
2. 接收端收到FIN后，返回ACK，表示我这里可能还有数据没有发送完；
3. 接收端确认数据发送完之后，主动向发送端发出结束连接请求FIN；
4. 接收端收到FIN请求后，返回ACK，表示确认收到了，你是否需要重传？一段时间后仍无响应，就会关闭连接。

##### 为何连接时需要握手三次，但在断连时需要挥手四次？

因为连接时不需要考虑双方的状态，但在断连时，为了确保数据完整性，需要考虑双方的状态。

当一段发送FIN时，仅代表自己没有数据可发送了，并不能确保对方也发送完了数据，所以在断连时需要4次挥手反复确认，以保证数据的完整性。

### TCP与UDP的区别

2. TCP可以保证数据顺序送达，并提供超时重传来包证可靠性；而UDP无法保证，所以UDP易丢数据。
3. TCP所需资源多，TCP首部20个字节；UDP首部只需要8字节。
4. TCP有流量控制和拥塞控制；UDP没有。
5. TCP只能一对一；UDP可以任意连接。
6. TCP面向字节流；UDP面向短报文。

### 怎样使UDP兼具TCP的优点

**在应用层像TCP一样使用UDP**。

1. 添加请求响应机制，确保数据发送到对端；
2. 添加发送和接受缓冲区；
3. 添加超时重传机制。